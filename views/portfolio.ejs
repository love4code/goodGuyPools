<%- include('partials/header', { title: 'Portfolio', siteSettings }) %>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">Our Work</h1>
  <form class="d-flex gap-2">
    <select name="type" class="form-select form-select-sm" onchange="this.form.submit()">
      <option value="">All Types</option>
      <option value="New Pool Construction" <%= type==='New Pool Construction'?'selected':'' %>>New Pool Construction</option>
      <option value="Renovation" <%= type==='Renovation'?'selected':'' %>>Renovation</option>
      <option value="Maintenance/Service" <%= type==='Maintenance/Service'?'selected':'' %>>Maintenance/Service</option>
    </select>
    <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
      <option value="">All Statuses</option>
      <option value="Planned" <%= status==='Planned'?'selected':'' %>>Planned</option>
      <option value="In Progress" <%= status==='In Progress'?'selected':'' %>>In Progress</option>
      <option value="Completed" <%= status==='Completed'?'selected':'' %>>Completed</option>
    </select>
  </form>
  </div>
<div class="row g-4">
  <% if (projects && projects.length) { %>
    <% projects.forEach(p => { %>
      <div class="col-md-4">
        <div class="card h-100">
          <% 
            let projectImgUrl = '';
            if (p.images && p.images.length > 0) {
              if (typeof p.images[0] === 'object' && p.images[0].sizes) {
                projectImgUrl = '/public/' + (p.images[0].sizes.medium?.url || p.images[0].sizes.large?.url || p.images[0].sizes.thumbnail?.url || '');
              } else if (typeof p.images[0] === 'string') {
                projectImgUrl = p.images[0];
              }
            } else if (p.featuredImage) {
              projectImgUrl = p.featuredImage;
            }
          %>
          <% if (projectImgUrl) { %>
            <img src="<%= projectImgUrl %>" class="card-img-top" alt="<%= p.title %>" style="height: 200px; object-fit: cover;">
          <% } %>
          <div class="card-body d-flex flex-column">
            <h3 class="h5"><%= p.title %></h3>
            <% if (p.summary) { %>
              <p class="card-text flex-grow-1"><%= p.summary %></p>
            <% } else if (p.shortDescription) { %>
              <p class="card-text flex-grow-1"><%= p.shortDescription %></p>
            <% } %>
            <a href="/portfolio/<%= p.slug %>" class="btn btn-sm btn-primary mt-auto">View Project</a>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <div class="col-12"><div class="alert alert-secondary">No projects found.</div></div>
  <% } %>
</div>
<%- include('partials/footer', { siteSettings }) %>


