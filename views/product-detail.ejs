<%- include('partials/header', { title: product.name, siteSettings }) %>
<div class="container my-5">
  <div class="row">
    <div class="col-md-6 mb-4">
      <% 
        let mainImageUrl = '';
        if (product.mainImage) {
          if (typeof product.mainImage === 'object' && product.mainImage.sizes) {
            mainImageUrl = '/public/' + (product.mainImage.sizes.large?.url || product.mainImage.sizes.medium?.url || product.mainImage.sizes.thumbnail?.url || '');
          }
        } else if (product.image) {
          mainImageUrl = product.image;
        }
      %>
      <% if (mainImageUrl) { %>
        <img src="<%= mainImageUrl %>" class="img-fluid rounded" alt="<%= product.name %>">
      <% } %>
      
      <% if (product.gallery && product.gallery.length > 0) { %>
        <div class="row g-2 mt-3">
          <% product.gallery.forEach(img => { %>
            <% 
              let galleryImgUrl = '';
              if (typeof img === 'object' && img.sizes) {
                galleryImgUrl = '/public/' + (img.sizes.medium?.url || img.sizes.large?.url || img.sizes.thumbnail?.url || '');
              } else if (typeof img === 'string') {
                galleryImgUrl = img;
              }
            %>
            <% if (galleryImgUrl) { %>
              <div class="col-md-4">
                <img src="<%= galleryImgUrl %>" class="img-thumbnail w-100" style="height: 150px; object-fit: cover;" alt="<%= product.name %>">
              </div>
            <% } %>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="col-md-6">
      <h1 class="h2 mb-3"><%= product.name %></h1>
      <% if (product.shortDescription) { %>
        <p class="lead"><%= product.shortDescription %></p>
      <% } %>
      <% if (product.description) { %>
        <div class="mb-4"><%- product.description %></div>
      <% } %>
      
      <% if (product.sizes && product.sizes.length > 0) { %>
        <div class="mb-4">
          <h3 class="h5 mb-3">Available Sizes</h3>
          <div class="d-flex flex-wrap gap-2">
            <% product.sizes.forEach(size => { %>
              <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;"><%= size %></span>
            <% }) %>
          </div>
        </div>
      <% } %>
      
      <% if (product.price) { %>
        <div class="mb-4">
          <h3 class="h5">Price</h3>
          <p class="fs-4 text-primary"><%= product.price %></p>
        </div>
      <% } %>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-lg-8 mx-auto">
      <div class="card">
        <div class="card-header">
          <h2 class="h4 mb-0">Request a Quote</h2>
        </div>
        <div class="card-body">
          <% if (typeof success !== 'undefined' && success && success.length > 0) { %>
            <div class="alert alert-success"><%= success[0] %></div>
          <% } %>
          <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
            <div class="alert alert-danger"><%= error[0] %></div>
          <% } %>

          <form action="/products/<%= product.slug %>/inquiry" method="POST">
            <input type="hidden" name="productId" value="<%= product._id %>">

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Name *</label>
                <input type="text" name="name" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email *</label>
                <input type="email" name="email" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Phone *</label>
                <input type="tel" name="phone" class="form-control" required>
              </div>
              <% if (product.sizes && product.sizes.length > 0) { %>
                <div class="col-md-6">
                  <label class="form-label">Size</label>
                  <select name="size" class="form-select">
                    <option value="">Select a size...</option>
                    <% product.sizes.forEach(size => { %>
                      <option value="<%= size %>"><%= size %></option>
                    <% }) %>
                  </select>
                </div>
              <% } %>
              <div class="col-12">
                <label class="form-label">Message</label>
                <textarea name="description" rows="5" class="form-control" placeholder="Tell us about your project..."></textarea>
              </div>
              <div class="col-12">
                <button type="submit" class="btn btn-primary btn-lg">Submit Inquiry</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer', { siteSettings }) %>
