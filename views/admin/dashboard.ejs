<%- include('../partials/header', { title: 'Admin Dashboard', settings }) %>
<div class="mb-4">
  <h1 class="h3">Dashboard</h1>
</div>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6"><%= stats.projectCount %></div>
        <div class="text-muted">Projects</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6"><%= stats.contactCount %></div>
        <div class="text-muted">Contact Inquiries</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6"><%= stats.productQuoteCount || 0 %></div>
        <div class="text-muted">Product Quotes</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6"><%= stats.totalViews %></div>
        <div class="text-muted">Total Views</div>
      </div>
    </div>
  </div>
</div>
<div class="row g-4">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h2 class="h5">Recent Contact Inquiries</h2>
        <ul class="list-group list-group-flush">
          <% if (recentContacts && recentContacts.length) { %>
            <% recentContacts.forEach(c => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= c.name %></strong> · <span class="text-muted"><%= c.town %></span>
                  <div class="small text-muted"><%= c.projectType %> · <%= new Date(c.createdAt).toLocaleString() %></div>
                </div>
                <a class="btn btn-sm btn-outline-primary" href="/admin/contacts/<%= c._id %>">View</a>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item">No contact inquiries yet.</li>
          <% } %>
        </ul>
        <div class="mt-2">
          <a href="/admin/contacts" class="btn btn-sm btn-outline-secondary">View All Contacts</a>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h2 class="h5">Recent Product Quote Requests</h2>
        <ul class="list-group list-group-flush">
          <% if (recentProductQuotes && recentProductQuotes.length) { %>
            <% recentProductQuotes.forEach(q => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= q.name %></strong> · <span class="text-muted"><%= q.city %></span>
                  <div class="small text-muted">
                    <span class="badge bg-info"><%= q.productName %></span>
                    · <%= q.serviceType %>
                    <% if (q.selectedSizes && q.selectedSizes.length > 0) { %>
                      · Sizes: <%= q.selectedSizes.join(', ') %>
                    <% } %>
                  </div>
                  <div class="small text-muted"><%= new Date(q.createdAt).toLocaleString() %></div>
                </div>
                <a class="btn btn-sm btn-outline-primary" href="/admin/product-quotes/<%= q._id %>">View</a>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item">No product quote requests yet.</li>
          <% } %>
        </ul>
        <div class="mt-2">
          <a href="/admin/product-quotes" class="btn btn-sm btn-outline-secondary">View All Quotes</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row g-4 mt-2">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
        <h2 class="h5">Top Pages</h2>
        <ul class="list-group list-group-flush">
          <% if (stats.topPages && stats.topPages.length) { %>
            <% stats.topPages.forEach(p => { %>
              <li class="list-group-item d-flex justify-content-between">
                <span><%= p._id %></span>
                <span class="badge bg-secondary"><%= p.count %></span>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item">No data yet.</li>
          <% } %>
        </ul>
      </div>
    </div>
  </div>
</div>
<%- include('../partials/footer', { settings }) %>


